config {
  type: "view",
  schema: "uk_real_estate",
  name: "population_rent_merge"
}

-- Create a new column in table2 and join table1 and table2
SELECT
  FORMAT_DATE('%m/%Y', PARSE_DATE('%b-%y', t1.time_period)) AS timeseries,
  t1.area_code AS area_code,
  t1.area_name AS area_name,
  t1.region AS home_address_region,
  t1.rental_price_one_bed AS rental_price_one_bed,
  t1.rental_price_two_bed AS rental_price_two_bed,
  t1.rental_price_three_bed AS rental_price_three_bed,
  t1.rental_price_four_bed AS rental_price_four_bed,
  t1.rental_price_detached AS rental_price_detached,
  t1.rental_price_flat_maisonette AS rental_price_flat_maisonette,
  t1.rental_price_semidetached AS rental_price_semidetached,
  t1.rental_price_terraced AS rental_price_terraced,
  t2.population_value AS population_value
FROM
  ${ref("rents_table")} t1
LEFT JOIN
  ${ref("area_population_table")} t2
ON
  t1.area_name = t2.area_name
ORDER BY 
  timeseries